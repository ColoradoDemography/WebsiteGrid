<!-- Net Migration Working Age Page A Bickford 6/2021 -->

<!DOCTYPE html>
<html>
<head>
<title>SDO Net Migration Working Age</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- FONT AWESOME CSS  Source for buttons the list of icons is here: https://fontawesome.com/icons?d=gallery&p=2 -->
<!-- angle-down, angle-double-down, angle-circle-down, angle-right, angle-circle-right, the new button is in common.css --> 
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" crossorigin="anonymous">
<!-- SDO CSS -->
<link type="text/css" rel="stylesheet" href="../css/common.css" async=""> 
<!-- adding d3.js  for data manipulation-->
 <script src="https://d3js.org/d3.v6.min.js"></script>
<!-- Adding Plotly.js for  charting -->
 <script src="https://cdn.plot.ly/plotly-1.58.4.min.js" charset="utf-8"></script>
<!-- SDO suport functions, genSYA, insertHTML, -->
<script src="../js/funct.js"></script>
</head>
<body>
<div>
<a href="https://cdola.colorado.gov/"><img class="logoSDO" src="../img/SDO-1600x400.jpg" alt="Department of Local Affairs Homepage"></a>
</div>
<div id="header-name">
<nav id="top-navigation-wrapper" style="display: block;">
<ul class="horiz">
<li class="horiz_item"><a href="https://coloradodemography.github.io/WebsiteGrid">State Demography Office</a> </li>
<li class="horiz_item"> <a href="https://cdola.colorado.gov/assessment-appeals">Assessment Appeals</a></li>
<li class="horiz_item"><a href="https://cdola.colorado.gov/housing">Housing</a></li>
<li class="horiz_item"> <a href="https://cdola.colorado.gov/local-government">Local Government</a></li>
<li class="horiz_item"> <a href="https://cdola.colorado.gov/property-taxation">Property Taxation</a></li>
</ul>
</nav>
</div>
<!-- First Grid, linked images -->
<div class="grid-container2">
  <div class="grid-item panel2_1_1">
			State Demography Office
			<br>The State Demography Office is the primary state agency for population and demographic information.
  </div>
   <div class="grid-item app-panel_2_1" id="leftHand">
	<div w3-include-html="../html/left_hand.html"></div>
  </div> <!-- Grid  panel2_2_1 -->
  <div class="grid-item app-panel_2_2">
  <b>Net Migration for Working Age Adults</b>
   <br><br>INSTRUCTIONS:
   <p>
   The following page shows graphs and charts for various datasets by county. Select the At least one county from the list below to view the graphs for the selected counties. 
   You can hover over specific data points on each graph to view the data for that specific point.
   </p>
   Click on the download icon on the left of each chart to download the chart and the underlying data.
   <br><br>
   <b><i>This data visualization can only be viewed on a tablet or desktop.</i></b>
   <br><br>
 	 <label for="county-dropdown"><b>Select County:</b></label>
	 <select class="county-dropdown" id="county-dropdown" multiple></select>
	 <label for="age-dropdown"><b>Select Age Group:</b></label>
	 <select class="age-dropdown" id="chart-dropdown">
		<option value="ageall">Total Population</option>
		<option value="age1864">Working Age Population (Persons Age 18 to 64)</option>
	 </select>
	 <label for="data-dropdown"><b>Select Data Series:</b></label>
	 <select class="data-dropdown" id="chart-dropdown">
		<option value="tot">Totals</option>
		<option value="rate">Rate (per 100 persons)</option>
	 </select>
	 <label for="chart-dropdown"><b>Select Chart Type:</b></label>
	 <select class="chart-dropdown" id="chart-dropdown">
		<option value="bar">Bar Chart</option>
		<option value="lines">Line Chart</option>
	 </select>

  </div>
  <div class="grid-item app-panel_3_2">
      <div class="dropdown AClass">
		  <button class="dropbtn"  id="estimate"><i class="fas fa-arrow-circle-down fa-2x" style='color: black;'></i></button>
		  <div class="dropdown-content">
			<a href="#" id='netmigtot_csv'>Download Data (CSV)</a>
			<a href='#' id='netmigtot_png'>Download Image (PNG)</a>
		  </div>
	  </div>
	 <div id="netmigtot_output"></div>
  </div>
  <div class="grid-item app-panel_4_2">
	<div class="dropdown AClass">
		<button class="dropbtn" id="forecast"><i class="fas fa-arrow-circle-down fa-2x" style='color: black;'></i></button>
	<div class="dropdown-content">
		<a href="#" id='netmigrrate_csv'>Download Data (CSV)</a>
		<a href='#' id='netmigrrate_png'>Download Image (PNG)</a>
	 </div>
	</div>
    <div id="netmigrrate_output"></div>
  </div>
 </div>  <!-- End of Grid -->


<script>

//Setting HTML include and Accordion
includeHTML(); 


/* Populate County Dropdown */
popDropdown('county','county-dropdown')

//generating maximum year value for estimates
var urlstr = "https://gis.dola.colorado.gov/lookups/componentYRS";
d3.json(urlstr).then(function(yeardata){
    var maxest = yeardata.filter(function(d){return d.datatype == 'Estimate'});
	var yrsList = maxest.map(function(d){return d.year;});
    var yrvalue = d3.max(yrsList);
	
//Generate Initial Tables
genNETMIG1864("000","Colorado", "ageall", "tot", "bar",yrvalue);

d3.select("#county-dropdown").on("change", function(d,i) {
        var selectedfips = d3.select("#county-dropdown").property('value');
		var selectedcounty = d3.select('#county-dropdown option:checked').text();
		var selecteddata = d3.select("#data-dropdown").property('value');
        var selectedchart = d3.select("#chart-dropdown").property('value');
        genNETMIG1864(selectedfips,selectedcounty,selectedage,selecteddata,selectedchart,yrvalue);
    });

d3.select("#age-dropdown").on("change", function(d,i) {
        var selectedfips = d3.select("#county-dropdown").property('value');
		var selectedcounty = d3.select('#county-dropdown option:checked').text();
		var selectedage = d3.select('#age-dropdown').property('value');
		var selecteddata = d3.select("#data-dropdown").property('value');
        var selectedchart = d3.select("#chart-dropdown").property('value');
        genNETMIG1864(selectedfips,selectedcounty,selectedage,selecteddata,selectedchart,yrvalue);
    });
	
d3.select("#data-dropdown").on("change", function(d,i) {
        var selectedfips = d3.select("#county-dropdown").property('value');
		var selectedcounty = d3.select('#county-dropdown option:checked').text();
		var selectedage = d3.select('#age-dropdown').property('value');
		var selecteddata = d3.select("#data-dropdown").property('value');
        var selectedchart = d3.select("#chart-dropdown").property('value');
        genNETMIG1864(selectedfips,selectedage,selectedcounty,selectedage,selecteddata,selectedchart,yrvalue);
    });

d3.select("#chart-dropdown").on("change", function(d,i) {
        var selectedfips = d3.select("#county-dropdown").property('value');
		var selectedcounty = d3.select('#county-dropdown option:checked').text();
		var selectedage = d3.select('#age-dropdown').property('value');
		var selecteddata = d3.select("#data-dropdown").property('value');
        var selectedchart = d3.select("#chart-dropdown").property('value');
        genNETMIG1864(selectedfips,selectedage,selectedcounty,selectedage,selecteddata,selectedchart,yrvalue);
    });
}); //end of maximum year value

//Function checks if selected div is loaded and runs Accordion

window.addEventListener('load', (event) => {
 var gridPanel = document.getElementById('leftHand');
 var accItem = gridPanel.getElementsByClassName('accordionItem');
 var accHD = gridPanel.getElementsByClassName('accordionItemHeading');
    for (i = 0; i < accHD.length; i++) {
        accHD[i].addEventListener('click', toggleItem, false);
    }
    function toggleItem() {
        var itemClass = this.parentNode.className;
        for (i = 0; i < accItem.length; i++) {
            accItem[i].className = 'accordionItem close';
        }
        if (itemClass == 'accordionItem close') {
            this.parentNode.className = 'accordionItem open';
        }
    };
});
</script>

</body>
</html> 